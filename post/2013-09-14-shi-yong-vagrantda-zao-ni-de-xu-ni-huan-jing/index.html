<!DOCTYPE html>
<html lang="zh_CN">
<head>
<meta charset="utf-8">
<title>使用Vagrant打造你的虚拟环境 - 老运维人员</title>
  <meta name="author" content="皓禹">
  <meta name="description" content="">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="http://www.linuxeden.com/favicon.ico">
  <link rel="shortcut icon" href="http://www.linuxeden.com/favicon.ico"  type="image/x-icon" />
<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link href="http://opslinux.com/theme/css/1.4.0/bootstrap.css" rel="stylesheet">
<link href="http://opslinux.com/theme/css/style.css" rel="stylesheet" type="text/css" media="all">
<link href="http://opslinux.com/atom.xml" type="application/atom+xml" rel="alternate" title="老运维人员 ATOM Feed" />
<link href="http://opslinux.com/rss.xml" type="application/atom+xml" rel="alternate" title="老运维人员 RSS Feed" />
</head>
  <body>
    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="http://opslinux.com">老运维人员</a>
<ul class="nav">
                              <li><a href="/categories.html">Categories</a></li>
                              <li><a href="/archives.html">Archives</a></li>
                              <li><a href="/tags.html">Tags</a></li>
                              <li><a href="/pages/about.html">About</a></li>
                              <li><a href="/pages/links.html">Links</a></li>              
                              
							  <li><a href="/random.html">Random</a></li>

            </ul>
			<div id="search"><form method="get" action="/search.html"><input type="text" value="" name="q" id="s"></form></div>
        </div>
      </div>
    </div>
    <div class="container"> 
	   <div class="content">  
 <div class="page-header">
  <h1>使用Vagrant打造你的虚拟环境</h1>
</div>
<div class="row">
  <div class="span10">
<h1>使用Vagrant打造你的虚拟环境</h1>
<p>因为要做mongDB的replication+sharding的实验，领导给我推荐Vagrant来模拟虚拟环境做部署实践，稍微了解够大为震惊，因网上文档不是特别容易理解，留下一份以备后用</p>
<p>vagrant的强大在于是一个镜像，配置完以后镜像可以放到任何地方去，真正做到了一劳永逸了。</p>
<p>总结一下自己使用vagrant的一点笔记，以免以后忘记还得再去翻官方文档。</p>
<p>vagrant的官方网站：http://www.vagrantup.com/ 现在又改版了，挺漂亮的。</p>
<p>vagrant的一些镜像：http://www.vagrantbox.es/ 各种linux都有。
然后按照官方说的，执行这三部，然后一个虚拟机就起来了。
注：先要安装VirtualBox</p>
<p><strong>配置box</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant box add debian http://ergonlogic.com/files/boxes/debian-current.box  <span class="c">#增加一个box,debian就是box的title 后面跟vagrant上的virtualbox镜像地址</span>
<span class="nv">$ </span>vagrant init debian <span class="c">#初始化debian</span>
<span class="nv">$ </span>vagrant up   <span class="c">#这个是真正的启动</span>
</pre></div>


<p>注意国内网速访问很慢 这里可以先去 <code>http://www.vagrantbox.es/</code> 下载你需要的镜像 然后把http那行直接换成你本地镜像的路径就ok比较方便和快捷</p>
<p><strong>连接虚拟主机</strong></p>
<p>你会看到终端显示了启动过程，启动完成后，我们就可以用 SSH 登录虚拟机了，剩下的步骤就是在虚拟机里配置你要运行的各种环境和参数了。</p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant ssh  <span class="c"># SSH 登录 ssh的后面可以跟你的title来连接不同的vm主机</span>
</pre></div>


<p><strong>打包分发</strong></p>
<p>当你配置好开发环境后，退出并关闭虚拟机。在终端里对开发环境进行打包：</p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant package
</pre></div>


<p>打包完成后会在当前目录生成一个 package.box 的文件，将这个文件传给其他用户，其他用户只要添加这个 box 并用其初始化自己的开发目录就能得到一个一模一样的开发环境了。</p>
<p><strong>常用命令</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant init  <span class="c"># 初始化</span>
<span class="nv">$ </span>vagrant up  <span class="c"># 启动虚拟机</span>
<span class="nv">$ </span>vagrant halt  <span class="c"># 关闭虚拟机</span>
<span class="nv">$ </span>vagrant reload  <span class="c"># 重启虚拟机</span>
<span class="nv">$ </span>vagrant ssh  <span class="c"># SSH 至虚拟机</span>
<span class="nv">$ </span>vagrant status  <span class="c"># 查看虚拟机运行状态</span>
<span class="nv">$ </span>vagrant destroy  <span class="c"># 销毁当前虚拟机</span>
</pre></div>


<p>box管理</p>
<div class="highlight"><pre><span class="nv">$vagrant</span> box list
<span class="nv">$vagrant</span> box add
<span class="nv">$vagrant</span> box remove
</pre></div>


<p>更多内容请查阅官方文档 http://docs.vagrantup.com/</p>
<p><strong>Multi-VM 多虚拟机</strong></p>
<div class="highlight"><pre><span class="nv">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>    <span class="c">#定义版本</span>
Vagrant.configure<span class="o">(</span>VAGRANTFILE_API_VERSION<span class="o">)</span> <span class="k">do</span> |config|  <span class="c">#使用内部2版本</span>
  config.vm.define :debian1 <span class="k">do</span> |debian1|   <span class="c">#定义第一台虚拟机，||里面就类似一个变量设置参数时使用 </span>
     debian1.vm.box <span class="o">=</span> <span class="s2">&quot;debian1&quot;</span>             <span class="c">#设置box名为debian1</span>
     debian1.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian1&quot;</span>      <span class="c">#设置hostname为debian1</span>
     debian1.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.11&quot;</span> <span class="c">#设置网络为内部网络 ip为192.168.1.11</span>
  end
  config.vm.define :debian2 <span class="k">do</span> |debian2|
     debian2.vm.box <span class="o">=</span> <span class="s2">&quot;debian2&quot;</span>
     debian2.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian2&quot;</span>
     debian2.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.12&quot;</span>
  end
  config.vm.define :debian3 <span class="k">do</span> |debian3|
     debian3.vm.box <span class="o">=</span> <span class="s2">&quot;debian3&quot;</span>
     debian3.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian3&quot;</span>
     debian3.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.13&quot;</span>
  end

end
</pre></div>


<p>注意语法格式就好，配置前关闭虚拟机，配置完后打开虚拟机。</p>
<p><strong>注意事项</strong></p>
<p>使用 Apache/Nginx 时会出现诸如图片修改后但页面刷新仍然是旧文件的情况，是由于静态文件缓存造成的。需要对虚拟机里的 Apache/Nginx 配置文件进行修改：</p>
<p>Apache 配置添加:</p>
<div class="highlight"><pre>EnableSendfile off
</pre></div>


<p>Nginx 配置添加:</p>
<div class="highlight"><pre>sendfile off;
</pre></div>
   <hr>
//翻页
   <div class="pagination">
      <ul>
	          <li class="prev"><a href="http://opslinux.com/post/2013-09-09-zabbixjian-kong-mongodb/">← Previous</a></li>
		        <li><a href="/archives.html">Archive</a></li>
		        <li class="next"><a href="http://opslinux.com/post/2013-10-25-nginxda-zao-3wgao-bing-fa-wang-zhan/">Next →</a></li>
		      </ul>
  </div>
  

<!-- Duoshuo Comment BEGIN -->
  <div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"ops"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
  </div>
   
  <div class="span4">
    <h4>目录<h4>
    使用Vagrant打造你的虚拟环境
    
    
    <h4>Published</h4>
    <div class="date"><span>2013-09-14 By <a href="http://opslinux.com/author/hao-yu.html">皓禹</a></span></div>
	<h4>Latest Articles</h4>
	<script language="JavaScript" src="http://feed2js.liluohost.com/feed2js.php?src=http%3A%2F%2Fopslinux.com%2Frss.xml&num=10&utf=y"  charset="UTF-8" type="text/javascript"></script>
	    	
  </div>
</div>
</div>
<footer>
<p>&copy; 2013 - 老运维人员 Powered by <a href="http://blog.getpelican.com/">Pelican</a>
          with help from <a href="http://jekyllbootstrap.com/" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>
    </div> <!-- /container -->
<script language="javascript" type="text/javascript" src="http://js.users.51.la/16460845.js"></script>
<noscript><a href="http://www.51.la/?16460845" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/16460845.asp" style="border:none" /></a></noscript>
  </body>
</html>