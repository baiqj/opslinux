<!DOCTYPE html>
<html lang="zhs">
<head>
                <title>老运维人员</title>
        <meta charset="utf-8" />
                                <link href="http://opslinux.com/atom.xml" type="application/atom+xml" rel="alternate" title="老运维人员 Atom Feed" />
                        <link href="http://opslinux.com/rss.xml" type="application/rss+xml" rel="alternate" title="老运维人员 RSS Feed" />
                                                </head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://opslinux.com">老运维人员 <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
                                      <li><a href="http://opslinux.com/pages/about.html">about</a></li>
                      <li><a href="http://opslinux.com/pages/links.html">links</a></li>
                          </ul></nav><!-- /#menu -->
        <section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://opslinux.com/post/2013-09-14-shi-yong-vagrantda-zao-ni-de-xu-ni-huan-jing/" rel="bookmark"
         title="Permalink to 使用Vagrant打造你的虚拟环境">使用Vagrant打造你的虚拟环境</a></h2>
  
  </header>
  <footer class="post-info">
    <abbr class="published" title="2013-09-14T00:00:00">
      2013-09-14
    </abbr>
        <address class="vcard author">
      By <a class="url fn" href="http://opslinux.com/author/hao-yu.html">皓禹</a>
    </address>
      </footer><!-- /.post-info -->
  <div class="entry-content">
    <h1>使用Vagrant打造你的虚拟环境</h1>
<p>因为要做mongDB的replication+sharding的实验，领导给我推荐Vagrant来模拟虚拟环境做部署实践，稍微了解够大为震惊，因网上文档不是特别容易理解，留下一份以备后用</p>
<p>vagrant的强大在于是一个镜像，配置完以后镜像可以放到任何地方去，真正做到了一劳永逸了。</p>
<p>总结一下自己使用vagrant的一点笔记，以免以后忘记还得再去翻官方文档。</p>
<p>vagrant的官方网站：http://www.vagrantup.com/ 现在又改版了，挺漂亮的。</p>
<p>vagrant的一些镜像：http://www.vagrantbox.es/ 各种linux都有。
然后按照官方说的，执行这三部，然后一个虚拟机就起来了。
注：先要安装VirtualBox</p>
<p><strong>配置box</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant box add debian http://ergonlogic.com/files/boxes/debian-current.box  <span class="c">#增加一个box,debian就是box的title 后面跟vagrant上的virtualbox镜像地址</span>
<span class="nv">$ </span>vagrant init debian <span class="c">#初始化debian</span>
<span class="nv">$ </span>vagrant up   <span class="c">#这个是真正的启动</span>
</pre></div>


<p>注意国内网速访问很慢 这里可以先去 <code>http://www.vagrantbox.es/</code> 下载你需要的镜像 然后把http那行直接换成你本地镜像的路径就ok比较方便和快捷</p>
<p><strong>连接虚拟主机</strong></p>
<p>你会看到终端显示了启动过程，启动完成后，我们就可以用 SSH 登录虚拟机了，剩下的步骤就是在虚拟机里配置你要运行的各种环境和参数了。</p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant ssh  <span class="c"># SSH 登录 ssh的后面可以跟你的title来连接不同的vm主机</span>
</pre></div>


<p><strong>打包分发</strong></p>
<p>当你配置好开发环境后，退出并关闭虚拟机。在终端里对开发环境进行打包：</p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant package
</pre></div>


<p>打包完成后会在当前目录生成一个 package.box 的文件，将这个文件传给其他用户，其他用户只要添加这个 box 并用其初始化自己的开发目录就能得到一个一模一样的开发环境了。</p>
<p><strong>常用命令</strong></p>
<div class="highlight"><pre><span class="nv">$ </span>vagrant init  <span class="c"># 初始化</span>
<span class="nv">$ </span>vagrant up  <span class="c"># 启动虚拟机</span>
<span class="nv">$ </span>vagrant halt  <span class="c"># 关闭虚拟机</span>
<span class="nv">$ </span>vagrant reload  <span class="c"># 重启虚拟机</span>
<span class="nv">$ </span>vagrant ssh  <span class="c"># SSH 至虚拟机</span>
<span class="nv">$ </span>vagrant status  <span class="c"># 查看虚拟机运行状态</span>
<span class="nv">$ </span>vagrant destroy  <span class="c"># 销毁当前虚拟机</span>
</pre></div>


<p>box管理</p>
<div class="highlight"><pre><span class="nv">$vagrant</span> box list
<span class="nv">$vagrant</span> box add
<span class="nv">$vagrant</span> box remove
</pre></div>


<p>更多内容请查阅官方文档 http://docs.vagrantup.com/</p>
<p><strong>Multi-VM 多虚拟机</strong></p>
<div class="highlight"><pre><span class="nv">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>    <span class="c">#定义版本</span>
Vagrant.configure<span class="o">(</span>VAGRANTFILE_API_VERSION<span class="o">)</span> <span class="k">do</span> |config|  <span class="c">#使用内部2版本</span>
  config.vm.define :debian1 <span class="k">do</span> |debian1|   <span class="c">#定义第一台虚拟机，||里面就类似一个变量设置参数时使用 </span>
     debian1.vm.box <span class="o">=</span> <span class="s2">&quot;debian1&quot;</span>             <span class="c">#设置box名为debian1</span>
     debian1.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian1&quot;</span>      <span class="c">#设置hostname为debian1</span>
     debian1.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.11&quot;</span> <span class="c">#设置网络为内部网络 ip为192.168.1.11</span>
  end
  config.vm.define :debian2 <span class="k">do</span> |debian2|
     debian2.vm.box <span class="o">=</span> <span class="s2">&quot;debian2&quot;</span>
     debian2.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian2&quot;</span>
     debian2.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.12&quot;</span>
  end
  config.vm.define :debian3 <span class="k">do</span> |debian3|
     debian3.vm.box <span class="o">=</span> <span class="s2">&quot;debian3&quot;</span>
     debian3.vm.host_name <span class="o">=</span> <span class="s2">&quot;debian3&quot;</span>
     debian3.vm.network :private_network, ip: <span class="s2">&quot;192.168.1.13&quot;</span>
  end

end
</pre></div>


<p>注意语法格式就好，配置前关闭虚拟机，配置完后打开虚拟机。</p>
<p><strong>注意事项</strong></p>
<p>使用 Apache/Nginx 时会出现诸如图片修改后但页面刷新仍然是旧文件的情况，是由于静态文件缓存造成的。需要对虚拟机里的 Apache/Nginx 配置文件进行修改：</p>
<p>Apache 配置添加:</p>
<div class="highlight"><pre>EnableSendfile off
</pre></div>


<p>Nginx 配置添加:</p>
<div class="highlight"><pre>sendfile off;
</pre></div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>